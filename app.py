import streamlit as st
import requests
from datetime import datetime

# Load API key from Streamlit Secrets (MUST SET REAL KEY for weather to work)
WEATHER_API_KEY = st.secrets.get("WEATHER_API_KEY", "YOUR_WEATHERAPI_KEY_HERE")

# Crop to pesticide mapping (Hindi descriptions)
pesticide_suggestions = {
    "wheat": "फंगीसाइड XYZ (उदाहरण: कार्बेंडाजिम) - जंग और स्मट से सुरक्षा।",
    "rice": "कीटनाशक ABC (उदाहरण: इमिडाक्लोप्रिड) - तना बोरर और पत्ती फोल्डर नियंत्रण।",
    "maize": "खरपतवारनाशक DEF (उदाहरण: एट्राजीन) - घास और चौड़ी पत्ती वाले खरपतवार प्रबंधन।",
    "cotton": "कीटनाशक GHI (उदाहरण: एंडोसल्फान) - बोलवर्म और एफिड्स पर निशाना।",
    "sugarcane": "कीटनाशक JKL (उदाहरण: क्लोरपायरीफॉस) - बोरर और दीमक से लड़ाई।",
}

# All 28 Indian States with 4-5 major districts (Hindi for UI)
states_districts = {
    "आंध्र प्रदेश": ["विशाखापत्तनम", "विजयवाड़ा", "गुंटूर", "कुरनूल", "अनंतपुर"],
    "अरुणाचल प्रदेश": ["इटानगर", "तवांग", "पापुम पारे", "लोहित"],
    "असम": ["गुवाहाटी", "डिब्रूगढ़", "जोरहाट", "सिलचर", "कामरूप"],
    "बिहार": ["पटना", "गया", "भागलपुर", "मुजफ्फरपुर", "पूर्णिया"],
    "छत्तीसगढ़": ["रायपुर", "दुर्ग", "बिलासपुर", "रायगढ़", "जांजगीर-चांपा"],
    "गोवा": ["पणजी", "मार्गाव", "साउस गोवा", "नॉर्थ गोवा"],
    "गुजरात": ["अहमदाबाद", "सूरत", "वडोदरा", "राजकोट", "भावनगर"],
    "हरियाणा": ["करनाल", "अंबाला", "कुरुक्षेत्र", "सिरसा", "फरीदाबाद"],
    "हिमाचल प्रदेश": ["शिमला", "मंडी", "कुल्लू", "कांगड़ा", "सोलन"],
    "झारखंड": ["रांची", "धनबाद", "जमशेदपुर", "गिरिडीह", "हजारीबाग"],
    "कर्नाटक": ["बेंगलुरु", "मैसूर", "हुबली", "बेलगाम", "मंगलुरु"],
    "केरल": ["तिरुवनंतपुरम", "कोच्चि", "कोझिकोड", "त्रिशूर", "कोट्टायम"],
    "मध्य प्रदेश": ["भोपाल", "इंदौर", "ग्वालियर", "जबलपुर", "उज्जैन"],
    "महाराष्ट्र": ["मुंबई", "पुणे", "नागपुर", "नासिक", "अमरावती"],
    "मणिपुर": ["इम्फाल पूर्व", "इम्फाल पश्चिम", "बिश्नुपुर", "थौबल"],
    "मेघालय": ["शिलांग", "ईस्ट खासी हिल्स", "वेस्ट गारो हिल्स", "ईस्ट गारो हिल्स"],
    "मिजोरम": ["आइजोल", "लुंगलेई", "चम्फाई", "कौलक"],
    "नागालैंड": ["कोहिमा", "दिमापुर", "मोकोकचुंग", "तुकेसांग"],
    "ओडिशा": ["भुवनेश्वर", "कटक", "बरम्पुर", "राउरकेला", "बालासोर"],
    "पंजाब": ["लुधियाना", "अमृतसर", "जालंधर", "पटियाला", "बठिंडा"],
    "राजस्थान": ["जयपुर", "जोधपुर", "उदयपुर", "कोटा", "बीकानेर"],
    "सिक्किम": ["गंगटोक", "मंगन", "ईस्ट सिक्किम", "वेस्ट सिक्किम"],
    "तमिलनाडु": ["चेन्नई", "कोयंबटूर", "मदुरै", "तिरुचिरापल्ली", "सलेम"],
    "तेलंगाना": ["हैदराबाद", "वरंगल", "निजामाबाद", "खम्मम", "महबूबनगर"],
    "त्रिपुरा": ["अगरतला", "उनाकोटी", "वेस्ट त्रिपुरा", "सिपाहिजाला"],
    "उत्तर प्रदेश": ["लखनऊ", "कानपुर", "आगरा", "वाराणसी", "मेरठ"],
    "उत्तराखंड": ["देहरादून", "हरिद्वार", "उधम सिंह नगर", "नैनीताल"],
    "पश्चिम बंगाल": ["कोलकाता", "हावड़ा", "दरजीलिंग", "बर्धमान", "मालदा"],
}

# Hindi District to English City Mapping (for Weather API - fixes wrong weather)
district_english_map = {
    "लुधियाना": "Ludhiana", "अमृतसर": "Amritsar", "जालंधर": "Jalandhar", "पटियाला": "Patiala", "बठिंडा": "Bathinda",
    "करनाल": "Karnal", "अंबाला": "Ambala", "कुरुक्षेत्र": "Kurukshetra", "सिरसा": "Sirsa", "फरीदाबाद": "Faridabad",
    "लखनऊ": "Lucknow", "कानपुर": "Kanpur", "आगरा": "Agra", "वाराणसी": "Varanasi", "मेरठ": "Meerut",
    "मुंबई": "Mumbai", "पुणे": "Pune", "नागपुर": "Nagpur", "नासिक": "Nashik", "अमरावती": "Amravati",
    "जयपुर": "Jaipur", "जोधपुर": "Jodhpur", "उदयपुर": "Udaipur", "कोटा": "Kota", "बीकानेर": "Bikaner",
    "भोपाल": "Bhopal", "इंदौर": "Indore", "ग्वालियर": "Gwalior", "जबलपुर": "Jabalpur", "उज्जैन": "Ujjain",
    "अहमदाबाद": "Ahmedabad", "सूरत": "Surat", "वडोदरा": "Vadodara", "राजकोट": "Rajkot", "भावनगर": "Bhavnagar",
    "पटना": "Patna", "गया": "Gaya", "भागलपुर": "Bhagalpur", "मुजफ्फरपुर": "Muzaffarpur", "पूर्णिया": "Purnia",
    "विशाखापत्तनम": "Visakhapatnam", "विजयवाड़ा": "Vijayawada", "गुंटूर": "Guntur", "कुरनूल": "Kurnool", "अनंतपुर": "Anantapur",
    "बेंगलुरु": "Bengaluru", "मैसूर": "Mysore", "हुबली": "Hubli", "बेलगाम": "Belgaum", "मंगलुरु": "Mangalore",
    "चेन्नई": "Chennai", "कोयंबटूर": "Coimbatore", "मदुरै": "Madurai", "तिरुचिरापल्ली": "Tiruchirappalli", "सलेम": "Salem",
    "हैदराबाद": "Hyderabad", "वरंगल": "Warangal", "निजामाबाद": "Nizamabad", "खम्मम": "Khammam", "महबूबनगर": "Mahbubnagar",
    "कोलकाता": "Kolkata", "हावड़ा": "Howrah", "दरजीलिंग": "Darjeeling", "बर्धमान": "Bardhaman", "मालदा": "Malda",
    "देहरादून": "Dehradun", "हरिद्वार": "Haridwar", "उधम सिंह नगर": "Udham Singh Nagar", "नैनीताल": "Nainital",
    "शिमला": "Shimla", "मंडी": "Mandi", "कुल्लू": "Kullu", "कांगड़ा": "Kangra", "सोलन": "Solan",
    "रांची": "Ranchi", "धनबाद": "Dhanbad", "जमशेदपुर": "Jamshedpur", "गिरिडीह": "Giridih", "हजारीबाग": "Hazaribagh",
    "भुवनेश्वर": "Bhubaneswar", "कटक": "Cuttack", "बरम्पुर": "Berhampur", "राउरकेला": "Rourkela", "बालासोर": "Balasore",
    "इटानगर": "Itanagar", "गुवाहाटी": "Guwahati", "रायपुर": "Raipur", "पणजी": "Panaji", "तिरुवनंतपुरम": "Thiruvananthapuram",
    "इम्फाल पूर्व": "Imphal", "शिलांग": "Shillong", "आइजोल": "Aizawl", "कोहिमा": "Kohima", "गंगटोक": "Gangtok", "अगरतला": "Agartala",
    "मार्गाव": "Margao", "दुर्ग": "Durg", "बिलासपुर": "Bilaspur", "रायगढ़": "Raigad", "जांजगीर-चांपा": "Janjgir-Champa",
    "ईस्ट खासी हिल्स": "East Khasi Hills", "वेस्ट गारो हिल्स": "West Garo Hills", "ईस्ट गारो हिल्स": "East Garo Hills", "लुंगलेई": "Lunglei",
    "चम्फाई": "Champhai", "कौलक": "Kolasib", "मोकोकचुंग": "Mokokchung", "तुकेसांग": "Tuensang", "साउस गोवा": "South Goa",
    "नॉर्थ गोवा": "North Goa", "कामरूप": "Kamrup", "सिलचर": "Silchar", "जोरहाट": "Jorhat", "डिब्रूगढ़": "Dibrugarh",
    "पापुम पारे": "Papum Pare", "लोहित": "Lohit", "विजयवाड़ा": "Vijayawada", "गुंटूर": "Guntur", "कुरनूल": "Kurnool",
    "अनंतपुर": "Anantapur", "त्रिशूर": "Thrissur", "कोझिकोड": "Kozhikode", "कोच्चि": "Kochi", "कोट्टायम": "Kottayam",
    "नासिक": "Nashik", "अमरावती": "Amravati", "नागपुर": "Nagpur", "पुणे": "Pune", "मुंबई": "Mumbai",
    "उज्जैन": "Ujjain", "जबलपुर": "Jabalpur", "ग्वालियर": "Gwalior", "इंदौर": "Indore", "भोपाल": "Bhopal",
    "बठिंडा": "Bathinda", "पटियाला": "Patiala", "जालंधर": "Jalandhar", "अमृतसर": "Amritsar", "लुधियाना": "Ludhiana",
    "बालासोर": "Balasore", "राउरकेला": "Rourkela", "बरम्पुर": "Berhampur", "
